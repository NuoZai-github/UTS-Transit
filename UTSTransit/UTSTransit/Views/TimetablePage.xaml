<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:UTSTransit.ViewModels"
             xmlns:models="clr-namespace:UTSTransit.Models"
             x:Class="UTSTransit.Views.TimetablePage"
             x:DataType="vm:TimetableViewModel"
             Title="Schedule">

    <Grid RowDefinitions="Auto, *">
        <!-- Header with Date Selector -->
        <VerticalStackLayout Padding="24,24,24,12" Spacing="16" BackgroundColor="{StaticResource Surface}">
            <Label Text="Bus Schedule" Style="{StaticResource HeaderLabel}"/>
            
            <!-- Date Chips -->
            <HorizontalStackLayout Spacing="12">
                <!-- Today Button -->
                <Border StrokeShape="RoundRectangle 20" 
                        BackgroundColor="{Binding TodayTabColor}" 
                        Padding="16,8" 
                        StrokeThickness="0">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SelectTodayCommand}"/>
                    </Border.GestureRecognizers>
                    <Label Text="Today" TextColor="{Binding TodayTextColor}" FontAttributes="Bold"/>
                </Border>
                
                <!-- Tomorrow Button -->
                <Border StrokeShape="RoundRectangle 20" 
                        BackgroundColor="{Binding TomorrowTabColor}" 
                        Padding="16,8" 
                        StrokeThickness="0">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SelectTomorrowCommand}"/>
                    </Border.GestureRecognizers>
                    <Label Text="Tomorrow" TextColor="{Binding TomorrowTextColor}" FontAttributes="Bold"/>
                </Border>
            </HorizontalStackLayout>
        </VerticalStackLayout>

        <!-- Schedule List -->
        <CollectionView Grid.Row="1" ItemsSource="{Binding Schedule}" Margin="16">
            <!-- Empty State - No schedules available -->
            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="32" Spacing="16">
                    <Label Text="ðŸšŒ" FontSize="64" HorizontalOptions="Center"/>
                    <Label Text="No slots available" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"
                           HorizontalOptions="Center"/>
                    <Label Text="{Binding EmptyMessage}" 
                           FontSize="14" 
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
            
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:TimetableItem">
                    <Frame Margin="0,6" Padding="0" CornerRadius="16" Opacity="{Binding ItemOpacity}">
                        <Grid ColumnDefinitions="80, *, Auto" Padding="16">
                            <!-- Time Column -->
                            <VerticalStackLayout VerticalOptions="Center">
                                <Label Text="{Binding DepartureTime}" 
                                       FontSize="18" 
                                       FontAttributes="Bold" 
                                       TextColor="{StaticResource Primary}"
                                       TextDecorations="{Binding TimeTextDecoration}"/>
                                <Label Text="Departs" 
                                       FontSize="12" 
                                       TextColor="{StaticResource TextSecondary}"/>
                            </VerticalStackLayout>

                            <!-- Route Info -->
                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Padding="16,0">
                                <Label Text="{Binding RouteName}" 
                                       FontAttributes="Bold" 
                                       FontSize="16" 
                                       TextColor="{StaticResource TextPrimary}"
                                       LineBreakMode="TailTruncation"
                                       TextDecorations="{Binding RouteTextDecoration}"/>
                                <Label Text="To Campus" 
                                       FontSize="13" 
                                       TextColor="{StaticResource TextSecondary}"/>
                            </VerticalStackLayout>
                            
                            <!-- Status and Book Action -->
                            <VerticalStackLayout Grid.Column="2" Spacing="8" VerticalOptions="Center">
                                <Border StrokeShape="RoundRectangle 8" 
                                        BackgroundColor="{StaticResource PageBackground}" 
                                        StrokeThickness="0"
                                        Padding="8,4"
                                        HorizontalOptions="End">
                                    <Label Text="{Binding Status}" 
                                           TextColor="{Binding StatusColor}" 
                                           FontAttributes="Bold"
                                           FontSize="12"/>
                                </Border>

                                <Button Text="{Binding ActionButtonText}"
                                        BackgroundColor="{Binding ActionButtonColor}"
                                        TextColor="White"
                                        FontSize="12"
                                        Padding="10,0"
                                        HeightRequest="32"
                                        CornerRadius="16"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:TimetableViewModel}}, Path=BookCommand}"
                                        CommandParameter="{Binding .}"
                                        IsEnabled="{Binding CanBook}" />
                            </VerticalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
